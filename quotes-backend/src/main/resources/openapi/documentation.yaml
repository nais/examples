openapi: "3.0.3"
info:
  title: "Quotes API"
  version: "1.0.0"
  description: |
    RESTful API for managing inspirational quotes with full CRUD operations.

    **Features:**
    - Create, read, update, and delete quotes
    - Search quotes by text or author
    - PostgreSQL persistence with audit logging
    - OpenTelemetry observability

    **Data Persistence:**
    All quotes are persisted in PostgreSQL and survive application restarts.
  contact:
    name: "NAIS Examples Team"
    url: "https://github.com/nais/examples"
servers:
  - url: "http://localhost:8080"
    description: "Local development"
  - url: "https://quotes-backend.dev.nav.cloud.nais.io"
    description: "Development"
paths:
  /api/quotes:
    get:
      operationId: getAllQuotes
      summary: Get all quotes
      description: Retrieve all quotes from the database
      tags:
        - Quotes
      responses:
        '200':
          description: List of quotes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Quote'
              examples:
                quotes:
                  summary: Example quotes
                  value:
                    - id: "1"
                      text: "Deploy with confidence—let Nais handle the platform, you focus on the code."
                      author: "Nais Team"
                    - id: "2"
                      text: "Kubernetes is complex, but Nais makes it simple for developers."
                      author: "Platform Engineer"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      operationId: createQuote
      summary: Create new quote
      description: Add a new quote to the database
      tags:
        - Quotes
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuoteInput'
            examples:
              newQuote:
                summary: New quote
                value:
                  text: "Innovation distinguishes between a leader and a follower."
                  author: "Steve Jobs"
      responses:
        '201':
          description: Quote created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quote'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/quotes/{id}:
    get:
      operationId: getQuoteById
      summary: Get quote by ID
      description: Retrieve a specific quote by its ID
      tags:
        - Quotes
      parameters:
        - name: id
          in: path
          required: true
          description: The quote ID
          schema:
            type: integer
            format: int32
            example: 1
      responses:
        '200':
          description: Quote found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quote'
        '400':
          description: Invalid ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Quote not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      operationId: updateQuote
      summary: Update quote
      description: Update an existing quote
      tags:
        - Quotes
      parameters:
        - name: id
          in: path
          required: true
          description: The quote ID to update
          schema:
            type: integer
            format: int32
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuoteInput'
            examples:
              updateQuote:
                summary: Updated quote
                value:
                  text: "Updated quote text"
                  author: "Updated Author"
      responses:
        '200':
          description: Quote updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quote'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Quote not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      operationId: deleteQuote
      summary: Delete quote
      description: Delete a quote from the database
      tags:
        - Quotes
      parameters:
        - name: id
          in: path
          required: true
          description: The quote ID to delete
          schema:
            type: integer
            format: int32
            example: 1
      responses:
        '204':
          description: Quote deleted successfully
        '400':
          description: Invalid ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Quote not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/quotes/search:
    get:
      operationId: searchQuotes
      summary: Search quotes
      description: Search for quotes by text or author
      tags:
        - Quotes
      parameters:
        - name: q
          in: query
          required: true
          description: Search query (searches both text and author fields)
          schema:
            type: string
            example: "Kubernetes"
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Quote'
        '400':
          description: Missing query parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /internal/health:
    get:
      operationId: healthCheck
      summary: Health check
      description: Check if the application is running
      tags:
        - Internal
      responses:
        '200':
          description: Application is healthy
          content:
            text/plain:
              schema:
                type: string
                example: "Application is healthy"
  /internal/ready:
    get:
      operationId: readinessCheck
      summary: Readiness check
      description: Check if application is ready. Initializes default quotes if database is empty.
      tags:
        - Internal
      responses:
        '200':
          description: Application is ready
          content:
            text/plain:
              schema:
                type: string
                example: "Application is ready"
        '503':
          description: Database not ready
          content:
            text/plain:
              schema:
                type: string
  /internal/stats:
    get:
      operationId: getStats
      summary: Get statistics
      description: Get database statistics including total quote count
      tags:
        - Internal
      responses:
        '200':
          description: Statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_quotes:
                    type: integer
                    format: int64
                    description: Total number of quotes in database
                    example: 42
components:
  schemas:
    Quote:
      type: object
      required:
        - text
        - author
      properties:
        id:
          type: string
          description: Unique identifier for the quote (auto-generated)
          example: "1"
        text:
          type: string
          description: The quote text
          maxLength: 1000
          example: "Deploy with confidence—let Nais handle the platform, you focus on the code."
        author:
          type: string
          description: The quote author
          maxLength: 255
          example: "Nais Team"
    QuoteInput:
      type: object
      required:
        - text
        - author
      properties:
        text:
          type: string
          description: The quote text
          minLength: 1
          maxLength: 1000
          example: "Innovation distinguishes between a leader and a follower."
        author:
          type: string
          description: The quote author
          minLength: 1
          maxLength: 255
          example: "Steve Jobs"
    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error code
          enum:
            - BAD_REQUEST
            - NOT_FOUND
            - MISSING_ID
            - INVALID_ID
            - MISSING_QUERY
            - DATABASE_ERROR
            - DESERIALIZATION_ERROR
          example: "NOT_FOUND"
        message:
          type: string
          description: Human-readable error message
          example: "Quote not found"
tags:
  - name: Quotes
    description: Operations for managing quotes (CRUD)
  - name: Internal
    description: Internal endpoints for health checks and monitoring
