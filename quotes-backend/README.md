
# Quotes Backend

The Quotes Backend is a Kotlin-based service built with Ktor. It provides a simple API for managing quotes, storing them in memory, and includes robust error handling and observability features.

## Features

- **Endpoints**:
  - `GET /api/quotes`: Retrieves all quotes.
  - `POST /api/quotes`: Adds a new quote (ID is auto-generated).
  - `GET /api/quotes/{id}`: Retrieves a quote by its ID.
  - `GET /internal/health`: Health check endpoint.
- **In-Memory Storage**: Quotes are stored in a thread-safe `ConcurrentHashMap`.
- **OpenAPI Specification**: The API specification is available at `/openapi`.
- **Swagger UI**: Interactive API documentation is available at `/swagger`.
- **Error Simulation**: The backend can simulate random errors for observability by adjusting the `globalErrorRate` variable (see tests).

## Prerequisites

- [Kotlin](https://kotlinlang.org/) 1.8 or later
- [Gradle](https://gradle.org/) 8.0 or later

## Running the Service

1. Clone the repository:

   ```bash
   git clone https://github.com/nais/examples/quotes-backend.git
   cd quotes-backend
   ```

2. Build the project:

   ```bash
   ./gradlew build
   ```

3. Run the service:

   ```bash
   ./gradlew run
   ```

   The service will start on `http://localhost:8080`.

## API Endpoints

### `GET /api/quotes`

Retrieves all quotes.

#### Response

- **200 OK**: Returns a list of quotes.

### `POST /api/quotes`

Adds a new quote. The `id` is generated by the backend and should not be included in the request body.

#### Request Body

- `text` (string, required): The quote text.
- `author` (string, required): The author of the quote.

#### Response

- **201 Created**: Returns the created quote as JSON, including the generated `id`.
- **400 Bad Request**: If required fields are missing or the request body is invalid, returns a JSON error:
  ```json
  {
    "error": "BAD_REQUEST",
    "message": "Failed to convert request body to class io.nais.quotesbackend.Quote"
  }
  ```

### `GET /api/quotes/{id}`

Retrieves a quote by its ID.

#### Path Parameters

- `id` (string): The ID of the quote to retrieve.

#### Response

- **200 OK**: Returns the quote.
- **404 Not Found**: If the quote does not exist.

## OpenAPI and Swagger

- OpenAPI specification: [http://localhost:8080/openapi](http://localhost:8080/openapi)
- Swagger UI: [http://localhost:8080/swagger](http://localhost:8080/swagger)

## Health Endpoint

- `GET /internal/health`: Returns `200 OK` and the string `Application is healthy` if the service is running.

## Testing

Run the tests using Gradle:

```bash
./gradlew test
```

The test suite covers all endpoints, error handling, and the error simulation feature (`globalErrorRate`).

## License

This project is licensed under the MIT License. See the LICENSE file for details.
